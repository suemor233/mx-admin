import{H as C}from"./rounded-button-c4b84c49.js";import{f as F,o as R,h as $,i as k,j as G,x as Q,y as v,R as m,u as X,w as I,p as Z,t as ee,k as te,q as ae,a as e,C as ue,F as le,bo as ne,bY as re,b$ as P,H as S,L as se,N as c,I as oe,d as f,cv as ie,b0 as N,P as ce,b as r,d4 as de,c0 as q,W as T,J as U}from"./index-1c0ad94e.js";import{T as pe}from"./index-adf59b30.js";import{u as ve}from"./use-table-351bde95.js";import{T as me}from"./Trash-8167b2ff.js";import{N as fe,a as A}from"./Tabs-f2676882.js";import{N as he}from"./Form-bead6e85.js";import{N as H}from"./FormItemRow-c0f55ca5.js";import{N as ge}from"./Avatar-7a28a698.js";import{N as xe}from"./Popconfirm-ee8ddab6.js";import"./DataTable-5246e860.js";import"./ChevronRight-46307fc8.js";import"./Icon-f76d8766.js";import"./index-ddd9133d.js";import"./Tooltip-e28b7be1.js";import"./Select-d9659482.js";import"./Tag-df8d4ca0.js";import"./Pagination-d23d7cbf.js";import"./prop-a1682621.js";import"./Forward-ff40209a.js";import"./Add-703be64f.js";import"./throttle-492ebc44.js";import"./FormItem-1d022448.js";const ye={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},we=k("g",{fill:"none"},[k("path",{d:"M17.5 12a5.5 5.5 0 1 1 0 10.999a5.5 5.5 0 0 1 0-11zM12 1.997c5.524 0 10.002 4.478 10.002 10.002c0 .263-.01.524-.03.782a6.503 6.503 0 0 0-1.475-1.052a8.501 8.501 0 1 0-8.765 8.767c.28.54.635 1.036 1.05 1.474c-.257.02-.518.03-.782.03c-5.524 0-10.002-4.478-10.002-10.001C1.998 6.476 6.476 1.998 12 1.998zm5.5 12l-.09.008a.5.5 0 0 0-.402.402l-.008.09v2.5L14.498 17l-.09.008a.5.5 0 0 0-.402.402l-.008.09l.008.09a.5.5 0 0 0 .402.402l.09.008H17v2.504l.008.09a.5.5 0 0 0 .402.401l.09.009l.09-.009a.5.5 0 0 0 .402-.402l.008-.09v-2.504l2.504.001l.09-.008a.5.5 0 0 0 .402-.402l.008-.09l-.008-.09a.5.5 0 0 0-.402-.402l-.09-.008H18v-2.5l-.008-.09a.5.5 0 0 0-.402-.403l-.09-.008zm-9.038.785a4.494 4.494 0 0 0 2.63 1.626a6.449 6.449 0 0 0-.079 1.51a5.982 5.982 0 0 1-3.73-2.208a.75.75 0 1 1 1.179-.928zM9 8.75a1.25 1.25 0 1 1 0 2.499A1.25 1.25 0 0 1 9 8.75zm6 0a1.25 1.25 0 1 1 0 2.499a1.25 1.25 0 0 1 0-2.499z",fill:"currentColor"})],-1),ke=[we];var Fe=F({name:"EmojiAdd24Regular",render:function(x,s){return R(),$("svg",ye,ke)}});const be={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Be=k("path",{fill:"none",stroke:"currentColor","stroke-linecap":"square","stroke-miterlimit":"10","stroke-width":"44",d:"M416 128L192 384l-96-96"},null,-1),Ee=[Be];var _e=F({name:"CheckmarkSharp",render:function(x,s){return R(),$("svg",be,Ee)}});const Ce={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Ne=k("path",{d:"M400 145.49L366.51 112L256 222.51L145.49 112L112 145.49L222.51 256L112 366.51L145.49 400L256 289.49L366.51 400L400 366.51L289.49 256L400 145.49z",fill:"currentColor"},null,-1),Te=[Ne];var Ae=F({name:"CloseSharp",render:function(x,s){return R(),$("svg",Ce,Te)}});const De=["(\u0E51\u2022\u0300\u3142\u2022\u0301)\u0648\u2727","(\xB0\u30FC\xB0\u3003)","o(\uFFE3\u30D8\uFFE3o\uFF03)","(\u0E51\xAF\u25E1\xAF\u0E51)","( \u2022\u0300 .\u032B \u2022\u0301 )\u2727","(\u3064\u0434\u2282)","(o\xB4\u03C9`o)","(\u2022\u0C6A\u2022 )","(>\u25BD<)","(\u0E51\u2022\u0300\u3142\u2022\u0301) \u2727","\u10DA(\u2579\u25E1\u2579\u10DA)","_(:\u0437\u300D\u2220)_","\u053E\u2038\u053E"," \u0295 \u2022\u0300 o \u2022\u0301 \u0294"," (\u2449\uFF65\u0306\u2313\uFF65\u0306\u2449)"," \u266B.(\u25D5\u2220\u25D5).\u266B"," | \u2022\u0301 \u25BE \u2022\u0300 |"," \u3033 \xB0 \u25BE \xB0 \u3035"," | \u2022\u0301 \u25BE \u2022\u0300 |"," \u22CB\u254F \u275B \u25E1 \u275B \u254F\u22CC"," (\u30FB\u2200\u30FB)"," (^\u30FB\u03C9\u30FB^ )","(\xB4\uFF65\u03C9\uFF65`)  ","(\u0E51\xB4\u3142`\u0E51) ","(\u0E51\u02D8 \u2083\u02D8\u0E51) ","(\u25CF\u2019\u03C9`\u25CF\uFF09","(\xB4\uFF65\u03C9\uFF65`)  "];var D=(a=>(a[a.Unread=0]="Unread",a[a.Read=1]="Read",a[a.Junk=2]="Junk",a))(D||{});function V(a){return typeof a=="function"||Object.prototype.toString.call(a)==="[object Object]"&&!ce(a)}var o;(function(a){a[a.Pending=0]="Pending",a[a.Marked=1]="Marked",a[a.Trash=2]="Trash"})(o||(o={}));const tt=F(()=>{const a=G(),x=Q(),s=v(+a.query.state),{data:z,checkedRowKeys:n,fetchDataFn:J,pager:O,loading:j}=ve((t,l)=>async(u=a.query.page||1,w=10)=>{const _=a.query.state,g=await m.api.comments.get({params:{page:u,size:w,state:_|0}});t.value=g.data,l.value=g.pagination}),b=X(),h=v(!1),i=v(null),d=v(""),B=v(),E=v(!1),L=async()=>{if(!!i.value)try{E.value=!0,await m.api.comments.master.reply(i.value.id).post({data:{text:d.value}}),h.value=!1,i.value=null,b.success("\u56DE\u590D\u6210\u529F\u5566~"),d.value="",await p()}finally{E.value=!1}},p=J;I(()=>a.query.page,async t=>{await p(t)},{immediate:!0}),I(()=>a.query.state,async t=>{z.value=[],n.value=[],N(()=>p())});async function y(t,l){Array.isArray(t)?await Promise.all(t.map(u=>m.api.comments(u).patch({data:{state:l}}))):await m.api.comments(t).patch({data:{state:l}}),b.success("\u64CD\u4F5C\u5B8C\u6210"),await p()}async function M(t){if(Array.isArray(t))try{await Promise.all(t.map(l=>m.api.comments(l).delete({errorHandler:u=>{}})))}catch{}else await m.api.comments(t).delete();await p(),b.success("\u5220\u9664\u6210\u529F")}const K=Z([{title:"",key:"avatar",width:60,render(t){return e(ge,{circle:!0,src:t.avatar},null)}},{title:"\u4F5C\u8005",key:"author",width:200,render(t,l){return e(f,{vertical:!0,size:2},{default:()=>[e("a",{href:t.url||"#",target:"_blank",rel:"noreferrer"},[t.author]),e("a",{href:`mailto:${t.mail}`||"",target:"_blank"},[t.mail]),e("div",null,[e(de,{ip:t.ip,trigger:"hover",triggerEl:e(q,{depth:"3",class:"select-all"},{default:()=>[t.ip]})},null)])]})}},{title:"\u5185\u5BB9",key:"text",render(t){const l=(()=>{switch(t.refType){case"Post":return`${T}/posts/${t.ref.category.slug}/${t.ref.slug}`;case"Note":return`${T}/notes/${t.ref.nid}`;case"Page":return`${T}/${t.ref.slug}`}})();return e(f,{vertical:!0,size:2},{default:()=>[e(f,{size:5},{default:()=>[e("span",null,[U(t.created)]),e("span",null,[r("\u4E8E")]),e("a",{href:l,target:"_blank"},[t.ref.title])]}),e("p",null,[t.text]),t.parent&&e("blockquote",{class:"border-l-[3px] border-solid border-primary-default pl-[12px] my-2 ml-4"},[e(f,{size:2,align:"center"},{default:()=>[e(q,{depth:"2"},{default:()=>[t.parent.author,r("\xA0\u5728\xA0"),U(t.parent.created),r("\xA0\u8BF4:\xA0"),t.parent.text]})]})]),e("div",{class:"space-x-3"},[s.value!==o.Marked&&e(c,{text:!0,size:"tiny",type:"success",onClick:()=>y(t.id,1)},{default:()=>[r("\u5DF2\u8BFB")]}),s.value!==o.Trash&&e(c,{text:!0,size:"tiny",type:"warning",onClick:()=>y(t.id,2)},{default:()=>[r("\u5783\u573E")]}),s.value!==o.Trash&&e(c,{text:!0,size:"tiny",type:"info",onClick:u=>{i.value=t,h.value=!0}},{default:()=>[r("\u56DE\u590D")]}),e(xe,{positiveText:"\u53D6\u6D88",negativeText:"\u5220\u9664",onNegativeClick:()=>{M(t.id)}},{trigger:()=>e(c,{text:!0,size:"tiny",type:"error"},{default:()=>[r("\u5220\u9664")]}),default:()=>e("span",{class:"max-w-48"},[r("\u786E\u5B9A\u8981\u5220\u9664 "),t.title,r(" ?")])})])]})}}]),W=ee(),{viewport:Y}=te(ae);return()=>e(ue,{actionsElement:e(le,null,[s.value!==o.Marked&&e(C,{name:"\u5DF2\u8BFB",disabled:n.value.length===0,icon:e(_e,null,null),variant:"success",onClick:()=>{y(n.value,D.Read),n.value.length=0}},null),s.value!==o.Trash&&e(C,{name:"\u6807\u8BB0\u4E3A\u5783\u573E",disabled:n.value.length===0,icon:e(me,null,null),variant:"warning",onClick:()=>{y(n.value,D.Junk),n.value.length=0}},null),e(C,{name:"\u5220\u9664",icon:e(Ae,null,null),variant:"error",disabled:n.value.length===0,onClick:()=>{W.warning({title:"\u8B66\u544A",content:"\u4F60\u786E\u5B9A\u8981\u5220\u9664\u591A\u6761\u8BC4\u8BBA\uFF1F",negativeText:"\u786E\u5B9A",positiveText:"\u4E0D\u786E\u5B9A",onNegativeClick:async()=>{await M(n.value),n.value.length=0}})}},null)])},{default:()=>[e(fe,{size:"medium",value:s.value,onUpdateValue:t=>{x.replace({name:ne.Comment,query:{state:t}}).then(()=>{s.value=t})}},{default:()=>[e(A,{name:o.Pending,tab:"\u672A\u8BFB"},{default:()=>[e("div",{class:""},null)]}),e(A,{name:o.Marked,tab:"\u5DF2\u8BFB"},{default:()=>[e("div",{class:""},null)]}),e(A,{name:o.Trash,tab:"\u5783\u573E"},{default:()=>[e("div",{class:""},null)]})]}),e(pe,{maxWidth:600,data:z,loading:j.value,onFetchData:p,pager:O,onUpdateCheckedRowKeys:t=>{n.value=t},columns:[{type:"selection",options:["none","all"],width:50},...K]},null),e(re,{transformOrigin:"center",show:!!h.value,onUpdateShow:t=>{t||(h.value=t)}},{default:()=>[i.value&&e(P,{style:"width: 500px;max-width: 90vw",headerStyle:{textAlign:"center"},title:`\u56DE\u590D: ${i.value.author}`},{default:()=>[e(he,{onSubmit:L},{default:()=>[e(H,{label:`${i.value.author} \u8BF4:`},{default:()=>[e(S,{disabled:!0,value:i.value.text,type:"textarea",autosize:{minRows:4,maxRows:10}},null)]}),e(H,{label:"\u56DE\u590D\u5185\u5BB9"},{default:()=>[e(S,{ref:B,value:d.value,type:"textarea",onInput:t=>d.value=t,autosize:{minRows:4,maxRows:10}},null)]}),e("div",{class:"flex justify-between"},[e(se,{trigger:"click",placement:Y.value.mobile?"top-end":"left"},{trigger(){return e(c,{text:!0,class:"text-[20px]"},{default:()=>[e(oe,null,{default:()=>[e(Fe,null,null)]})]})},default(){let t;return e(P,{style:"max-width: 300px",bordered:!1},{default:()=>[e(f,{align:"center",class:"!justify-between"},V(t=De.map(l=>e(c,{text:!0,key:l,type:"primary",onClick:()=>{if(!B.value)return;const u=ie(B.value).textareaElRef;u.focus(),N(()=>{const w=u.selectionStart,_=u.selectionEnd;u.value=`${u.value.substring(0,w)} ${l} ${u.value.substring(_,u.value.length)}`,d.value=u.value,N(()=>{const g=w+l.length+2;u.selectionStart=g,u.selectionEnd=g,u.focus()})})}},V(l)?l:{default:()=>[l]})))?t:{default:()=>[t]})]})}}),e(f,{size:12,align:"center",inline:!0},{default:()=>[e(c,{type:"success",onClick:L,round:!0,loading:E.value},{default:()=>[r("\u786E\u5B9A")]}),e(c,{onClick:()=>{d.value="",h.value=!1},round:!0},{default:()=>[r("\u53D6\u6D88")]})]})])]})]})]})]})});export{tt as default};
