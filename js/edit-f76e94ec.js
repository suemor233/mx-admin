import{H as j}from"./rounded-button-77c7ccde.js";import{E as $}from"./toggle-e42319eb.js";import{f as g,t as R,a,dq as D,y as w,H as p,N as P,b as C,F as U,j as V,x as k,p as q,n as E,m as G,R as v,C as S,db as T,bo as A,bn as B}from"./index-6e7759df.js";import{u as H}from"./use-parse-payload-d0d61959.js";import{i as M}from"./isString-79ae3c94.js";import{t as L}from"./transform-dcc20f21.js";import{N as W}from"./Form-4ebafc98.js";import{N as i}from"./FormItem-7cf58170.js";import{N as _}from"./DynamicTags-249e2d48.js";import"./use-react-7dbf5132.js";import"./use-save-confirm-d8e8f5e2.js";import"./throttle-3e23936a.js";import"./InputNumber-3a1b60c8.js";import"./Add-b7baeac9.js";import"./Switch-2cf3a444.js";import"./Select-bf96ff63.js";import"./Tag-b1b9f704.js";import"./_arrayEach-2ff48152.js";import"./index-731c4fac.js";import"./prop-a1682621.js";const x="https://api.github.com/",K=(s,u)=>fetch(`${x}repos/${s}/${u}`).then(l=>l.json()),O=(s,u)=>fetch(`${x}repos/${s}/${u}/readme`).then(l=>l.json()).catch(l=>null).then(l=>{if(l){const m=(()=>{const t=l.download_url.split("/"),r=t.pop(),c=t.pop();return`https://fastly.jsdelivr.net/gh/${s}/${u}@${c}/${r}`})();return fetch(m).then(t=>t.text())}return null}),z=g({props:{onData:{type:Function,required:!0},defaultValue:{type:String}},setup(s){const u=R(),l=()=>{const m=u.create({title:"\u4ECE Github \u89E3\u6790",content:()=>{const t=g({setup(){const r=w(s.defaultValue??""),c=w(!1),f=async()=>{c.value=!0;const o=r.value.replace(/\.git$/,"").replace(/^https?:\/\/github.com\//,""),[n,d]=o.split("/"),[h,b]=await Promise.all([K(n,d),O(n,d)]);s.onData(h,b),c.value=!1,requestAnimationFrame(()=>{m.destroy()})};return()=>a(U,null,[a(p,{onKeydown:e=>{e.code==="Enter"&&f()},class:"my-4",value:r.value,placeholder:"\u5728\u6B64\u8F93\u5165\u9879\u76EE\u5730\u5740",onUpdateValue:e=>void(r.value=e)},null),a("div",{class:"flex space-x-4 justify-end"},[a(P,{type:"primary",round:!0,onClick:f,loading:c.value},{default:()=>[C("\u83B7\u53D6")]})])])}});return a(t,null,null)}})};return()=>a(j,{color:"#25292E",icon:a(D,null,null),name:"\u4ECE GitHub \u83B7\u53D6",onClick:l},null)}}),he=g({setup(){const s=V(),u=k(),l=()=>({name:"",previewUrl:"",docUrl:"",projectUrl:"",images:[],description:"",avatar:"",text:"",id:void 0}),m=e=>H(t)(e),t=q(l()),r=E(()=>s.query.id);G(async()=>{const e=r.value;if(e&&typeof e=="string"){const n=(await v.api.projects(e).get({})).data;m(n)}});const c=async()=>{const e=()=>{try{if(!t.text||t.text.trim().length==0)throw"\u5185\u5BB9\u4E3A\u7A7A";return{...L(B(t),(o,n,d)=>(o[d]=typeof n>"u"?null:typeof n=="string"&&n.length==0?"":n,o)),text:t.text.trim()}}catch(o){throw message.error(o),o}};if(r.value){if(!M(r.value))return;const o=r.value;await v.api.projects(o).put({data:e()}),message.success("\u4FEE\u6539\u6210\u529F")}else await v.api.projects.post({data:e()}),message.success("\u53D1\u5E03\u6210\u529F");u.push({name:A.ListProject})},f=(e,o)=>{const{html_url:n,homepage:d,description:h}=e;Object.assign(t,{description:h,projectUrl:n,previewUrl:d,images:(I=>{const F=/(?<=!\[.*\]\()(.+)(?=\))/g,y=[];for(const N of I.matchAll(F))y.push(N[0]);return y})(o||""),name:e.name,text:o||""})};return()=>a(S,{actionsElement:a(U,null,[a(z,{onData:f,defaultValue:t.projectUrl},null),a(j,{variant:"primary",onClick:c,icon:a(T,null,null)},null)])},{default:()=>[a(W,{labelWidth:"7rem",labelPlacement:"left",labelAlign:"left"},{default:()=>[a(i,{label:"\u9879\u76EE\u540D\u79F0",required:!0},{default:()=>[a(p,{autofocus:!0,placeholder:"",value:t.name,onInput:e=>void(t.name=e)},null)]}),a(i,{label:"\u6587\u6863\u5730\u5740"},{default:()=>[a(p,{placeholder:"",value:t.docUrl,onInput:e=>void(t.docUrl=e)},null)]}),a(i,{label:"\u9884\u89C8\u5730\u5740"},{default:()=>[a(p,{placeholder:"",value:t.previewUrl,onInput:e=>void(t.previewUrl=e)},null)]}),a(i,{label:"\u9879\u76EE\u5730\u5740"},{default:()=>[a(p,{placeholder:"",value:t.projectUrl,onInput:e=>void(t.projectUrl=e)},null)]}),a(i,{label:"\u9879\u76EE\u63CF\u8FF0",required:!0},{default:()=>[a(p,{placeholder:"",value:t.description,onInput:e=>void(t.description=e)},null)]}),a(i,{label:"\u9879\u76EE\u56FE\u6807"},{default:()=>[a(p,{placeholder:"",value:t.avatar,onInput:e=>void(t.avatar=e)},null)]}),a(i,{label:"\u9884\u89C8\u56FE\u7247"},{default:()=>[a(_,{round:!0,value:t.images,onUpdateValue:e=>void(t.images=e)},null)]}),a(i,{label:"\u6B63\u6587",required:!0},{default:()=>[a("div",{class:"w-full"},[a($,{unSaveConfirm:!1,class:"h-80 w-full",loading:!!(r.value&&!t.id),onChange:e=>{t.text=e},text:t.text},null)])]})]})]})}});export{he as default};
