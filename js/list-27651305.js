import{d as v,o as D,e as O,f as I,R as l,u as _,i as j,w as N,j as R,k as A,l as M,m as L,h as t,C as z,F as B,B as U,I as C,N as V,a as H,A as K,n as S}from"./index-62a644ac.js";import{T as q}from"./title-link-595ab951.js";import{D as G}from"./delete-confirm-f1f3cc86.js";import{T as J}from"./index-36f7419e.js";import{E as Q}from"./edit-column-640bd679.js";import{R as F}from"./relative-time-0c984ec4.js";import{u as W}from"./use-table-402cddc8.js";import{H as X}from"./rounded-button-789e2601.js";import{N as Y}from"./Popconfirm-f49290bc.js";import"./ExternalLink-5d4943f2.js";import"./DataTable-4010003d.js";import"./Icon-efb52841.js";import"./Select-ed5812f0.js";import"./Tag-d545e93d.js";import"./Forward-947f70cd.js";import"./index-c486619c.js";import"./ChevronRight-b5bf07a7.js";import"./Tooltip-5b6cbc1e.js";const Z={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},$=I("path",{d:"M104 224H24c-13.255 0-24 10.745-24 24v240c0 13.255 10.745 24 24 24h80c13.255 0 24-10.745 24-24V248c0-13.255-10.745-24-24-24zM64 472c-13.255 0-24-10.745-24-24s10.745-24 24-24s24 10.745 24 24s-10.745 24-24 24zM384 81.452c0 42.416-25.97 66.208-33.277 94.548h101.723c33.397 0 59.397 27.746 59.553 58.098c.084 17.938-7.546 37.249-19.439 49.197l-.11.11c9.836 23.337 8.237 56.037-9.308 79.469c8.681 25.895-.069 57.704-16.382 74.757c4.298 17.598 2.244 32.575-6.148 44.632C440.202 511.587 389.616 512 346.839 512l-2.845-.001c-48.287-.017-87.806-17.598-119.56-31.725c-15.957-7.099-36.821-15.887-52.651-16.178c-6.54-.12-11.783-5.457-11.783-11.998v-213.77c0-3.2 1.282-6.271 3.558-8.521c39.614-39.144 56.648-80.587 89.117-113.111c14.804-14.832 20.188-37.236 25.393-58.902C282.515 39.293 291.817 0 312 0c24 0 72 8 72 81.452z",fill:"currentColor"},null,-1),ee=[$];var te=v({name:"ThumbsUp",render:function(n,c){return D(),O("svg",Z,ee)}});const ke=v({name:"PostList",setup(){const{loading:w,checkedRowKeys:n,data:c,pager:m,sortProps:i,fetchDataFn:T}=W((s,r)=>async(e=k.query.page||1,y=20)=>{const a=await l.api.posts.get({params:{page:e,size:y,select:"title _id id created modified slug categoryId copyright tags count",...i.sortBy?{sortBy:i.sortBy,sortOrder:i.sortOrder}:{}}});s.value=a.data,r.value=a.pagination}),g=_(),k=j(),o=T;N(()=>k.query.page,async s=>{await o(s)});const u=R(z);A(async()=>{await o(),await u.fetch()});const b=v({setup(){const s=M(()=>u.data.value?.map(e=>({label:e.name,value:e.id}))||[]),r=L([{type:"selection",options:["none","all"]},{title:"\u6807\u9898",sortOrder:!1,sorter:"default",key:"title",width:200,ellipsis:!0,render(e){return t(B,null,t(q,{id:e.id,title:e.title,inPageTo:"/posts/edit?id="+e.id,externalLinkTo:"/posts/"+e.category.slug+"/"+e.slug}))}},{title:"\u5206\u7C7B",sortOrder:!1,sorter:"default",key:"category",width:80,ellipsis:!0,filterOptions:s,filter:!0,render(e){return u.map.value?t(Q,{returnToConfrim:!1,initialValue:u.map.value.get(e.categoryId)?.name??"",onSubmit:async a=>{await l.api.posts(e.id).patch({data:{categoryId:a}}),g.success("\u4FEE\u6539\u6210\u529F~!"),c.value.find(f=>f.id===e.id).categoryId=a},type:"select",options:u.data.value?.map(a=>({label:a.name,value:a.id,key:a.id}))||[]}):""}},{title:"\u6807\u7B7E",key:"tags",width:100,ellipsis:!0,render(e){return e.tags?.join("\uFF0C")}},{title:()=>t(C,null,t(U,null)),key:"count.read",width:50,render(e){return e.count?.read||0}},{title:()=>t(C,null,t(te,null)),width:50,key:"count.like",render(e){return e.count?.like||0}},{title:"\u521B\u5EFA\u4E8E",width:100,key:"created",sortOrder:"descend",sorter:"default",render(e){return t(F,{time:e.created})}},{title:"\u4FEE\u6539\u4E8E",key:"modified",sorter:"default",sortOrder:!1,width:100,render(e){return t(F,{time:e.modified})}},{title:"\u64CD\u4F5C",fixed:"right",width:60,key:"id",render(e){return t(H,null,t(Y,{positiveText:"\u53D6\u6D88",negativeText:"\u5220\u9664",onNegativeClick:async()=>{await l.api.posts(e.id).delete(),g.success("\u5220\u9664\u6210\u529F"),await o(m.value.currentPage)}},{trigger:()=>t(V,{text:!0,type:"error",size:"tiny"},"\u79FB\u9664"),default:()=>t("span",{class:"max-w-48"},"\u786E\u5B9A\u8981\u5220\u9664 ",e.title," ?")}))}}]);return()=>t(J,{loading:w.value,columns:r,data:c,nTableProps:{onUpdateFilters:async(e,y)=>{if(!!e&&e.category&&Array.isArray(e.category)){if(!e.category.length){await o();return}const f=e.category.join(",");let{entries:E}=await l.api.categories.get({params:{ids:f}});const P=Object.values(E).reduce((h,d)=>{const x=d.children?.map(p=>(Object.defineProperty(p,"categoryId",{value:d.id,enumerable:!0}),Object.defineProperty(p,"category",{get(){return p},enumerable:!1}),p));return[...h,...x]},[]).sort((h,d)=>+new Date(h.created)-+new Date(d.created));c.value=P,m.value={currentPage:1,total:1,size:0,hasNextPage:!1,hasPrevPage:!1,totalPage:1}}}},onFetchData:o,pager:m,onUpdateCheckedRowKeys:e=>{n.value=e},onUpdateSorter:async e=>{i.sortBy=e.sortBy,i.sortOrder=e.sortOrder}})}});return()=>t(S,null,{actions:()=>t(B,null,t(G,{checkedRowKeys:n.value,onDelete:async()=>{const s=await Promise.allSettled(n.value.map(r=>l.api.posts(r).delete()));for(const r of s)r.status==="rejected"&&g.success("\u5220\u9664\u5931\u8D25\uFF0C"+r.reason.message);n.value.length=0,o()}}),t(X,{to:"/posts/edit",icon:t(K,null)})),default:()=>t(b,null)})}});export{ke as ManagePostListView};
